<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 Professional - The Ultimate Tile Game</title>
    <meta name="description" content="Play the professional version of 2048 with multiple grid sizes, advanced statistics, achievements, and offline support. The ultimate tile puzzle game experience.">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#5D4E37">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="2048 Pro">
    <meta name="msapplication-TileColor" content="#8B4513">
    
    <!-- Icons -->
    <link rel="icon" href="img/2048.png" type="image/png">
    <link rel="apple-touch-icon" sizes="192x192" href="img/2048.png">
    <link rel="apple-touch-icon" sizes="512x512" href="img/2048.png">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6570625582499740"
     crossorigin="anonymous"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9MBX5GXMM9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-9MBX5GXMM9');
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="container">
        <div class="game-section">
            <div class="header">
                <div class="title-section">
                    <h1>2048</h1>
                    <div class="score-container">
                        <div class="score-box">
                            <span class="score-label">SCORE</span>
                            <span id="score">0</span>
                        </div>
                        <div class="score-box">
                            <span class="score-label">BEST</span>
                            <span id="best-score">0</span>
                        </div>
                    </div>
                </div>
                <div class="grid-size-selector">
                    <label for="grid-size">Grid Size:</label>
                    <select id="grid-size">
                        <option value="4">4×4 (Classic)</option>
                        <option value="5">5×5 (Advanced)</option>
                        <option value="6">6×6 (Expert)</option>
                    </select>
                </div>
                <p class="game-intro">Join the tiles and get to <strong>2048!</strong></p>
                <p class="instructions">Use your <strong>arrow keys</strong> or <strong>WASD</strong> to move the tiles.
                </p>
            </div>

            <div class="game-container">
                <div class="game-layout">
                    <div class="grid-area">
                        <div class="grid-container" id="grid-container">
                            <!-- Grid cells will be generated by JavaScript -->
                        </div>
                    </div>
                    <div class="control-area">
                        <button id="new-game" class="game-control-btn" title="New Game">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button id="undo" class="game-control-btn" title="Undo Last Move">
                            <i class="fas fa-undo"></i>
                        </button>
                        <button id="help-btn" class="game-control-btn" title="Show Help">
                            <i class="fas fa-question-circle"></i>
                        </button>
                    </div>
                </div>
                <div id="game-over" class="game-message">
                    <p>Game Over!</p>
                    <div class="final-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="final-score">0</div>
                            <div class="stat-label">Final Score</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="highest-tile">0</div>
                            <div class="stat-label">Highest Tile</div>
                        </div>
                    </div>
                    <button id="try-again"><i class="fas fa-redo"></i> Try Again</button>
                </div>
                <div id="game-won" class="game-message">
                    <p>You Won!</p>
                    <button id="keep-playing"><i class="fas fa-play"></i> Keep Playing</button>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h3><i class="fas fa-chart-bar"></i> Advanced Statistics</h3>
            <div class="stats-container">
                <div class="stat-box">
                    <div class="stat-value" id="games-played">0</div>
                    <div class="stat-label">Games Played</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="games-won">0</div>
                    <div class="stat-label">Games Won</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="win-rate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="avg-score">0</div>
                    <div class="stat-label">Average Score</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="avg-moves">0</div>
                    <div class="stat-label">Avg Moves</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="avg-time">0:00</div>
                    <div class="stat-label">Avg Time</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="current-streak">0</div>
                    <div class="stat-label">Win Streak</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="best-streak">0</div>
                    <div class="stat-label">Best Streak</div>
                </div>
            </div>

            <div class="performance-section">
                <h4><i class="fas fa-chart-line"></i> Performance Metrics</h4>
                <div class="performance-grid">
                    <div class="performance-card">
                        <div class="performance-title">Efficiency Rating</div>
                        <div class="performance-value" id="efficiency-rating">0</div>
                        <div class="performance-desc">Score per move ratio</div>
                    </div>
                    <div class="performance-card">
                        <div class="performance-title">Speed Rating</div>
                        <div class="performance-value" id="speed-rating">0</div>
                        <div class="performance-desc">Score per minute</div>
                    </div>
                    <div class="performance-card">
                        <div class="performance-title">Highest Tile</div>
                        <div class="performance-value" id="highest-achieved">2</div>
                        <div class="performance-desc">Best tile reached</div>
                    </div>
                </div>
            </div>

            <div class="leaderboard">
                <h3 class="leaderboard-title"><i class="fas fa-trophy"></i> Top Scores</h3>
                <div id="leaderboard-entries">
                    <!-- Leaderboard entries will be generated by JavaScript -->
                </div>
            </div>

            <div class="achievements">
                <h3 class="achievements-title"><i class="fas fa-medal"></i> Achievements</h3>
                <div id="achievements-list">
                    <div class="achievement-item" data-score="128">
                        <i class="achievement-icon fas fa-star"></i>
                        <span>Reach 128</span>
                    </div>
                    <div class="achievement-item" data-score="256">
                        <i class="achievement-icon fas fa-star"></i>
                        <span>Reach 256</span>
                    </div>
                    <div class="achievement-item" data-score="512">
                        <i class="achievement-icon fas fa-star"></i>
                        <span>Reach 512</span>
                    </div>
                    <div class="achievement-item" data-score="1024">
                        <i class="achievement-icon fas fa-star"></i>
                        <span>Reach 1024</span>
                    </div>
                    <div class="achievement-item" data-score="2048">
                        <i class="achievement-icon fas fa-crown"></i>
                        <span>Win the Game!</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="help-overlay" id="help-overlay">
        <div class="help-content">
            <h2><i class="fas fa-question-circle"></i> How to Play</h2>
            <p>Combine tiles with the same numbers to create larger numbers. Reach 2048 to win!</p>

            <div class="shortcut-list">
                <div class="shortcut-item">
                    <span class="key">↑</span> or <span class="key">W</span>
                    <span>Move Up</span>
                </div>
                <div class="shortcut-item">
                    <span class="key">↓</span> or <span class="key">S</span>
                    <span>Move Down</span>
                </div>
                <div class="shortcut-item">
                    <span class="key">←</span> or <span class="key">A</span>
                    <span>Move Left</span>
                </div>
                <div class="shortcut-item">
                    <span class="key">→</span> or <span class="key">D</span>
                    <span>Move Right</span>
                </div>
                <div class="shortcut-item">
                    <span class="key">Z</span>
                    <span>Undo Move</span>
                </div>
                <div class="shortcut-item">
                    <span class="key">R</span>
                    <span>New Game</span>
                </div>
                <div class="shortcut-item">
                    <span class="key">H</span>
                    <span>Show/Hide Help</span>
                </div>
            </div>

            <button id="close-help"><i class="fas fa-times"></i> Close</button>
        </div>
    </div>

    <!-- PWA Install Prompt -->
    <div id="pwa-install-prompt" class="pwa-install-prompt" style="display: none;">
        <div class="pwa-prompt-content">
            <h3><i class="fas fa-mobile-alt"></i> Install 2048 Pro</h3>
            <p>Add to your home screen for the best experience!</p>
            <div class="pwa-prompt-buttons">
                <button id="pwa-install-btn" class="pwa-install-btn">
                    <i class="fas fa-download"></i> Install App
                </button>
                <button id="pwa-dismiss-btn" class="pwa-dismiss-btn">
                    <i class="fas fa-times"></i> Not Now
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA Install Prompt Handler
        let deferredPrompt;
        let installPromptShown = localStorage.getItem('pwaInstallPromptShown') === 'true';

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show custom install prompt after a delay if not shown before
            if (!installPromptShown) {
                setTimeout(() => {
                    showInstallPrompt();
                }, 5000); // Show after 5 seconds
            }
        });

        function showInstallPrompt() {
            const installPrompt = document.getElementById('pwa-install-prompt');
            const installBtn = document.getElementById('pwa-install-btn');
            const dismissBtn = document.getElementById('pwa-dismiss-btn');
            
            installPrompt.style.display = 'flex';
            
            installBtn.addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the A2HS prompt');
                        }
                        deferredPrompt = null;
                        installPrompt.style.display = 'none';
                        localStorage.setItem('pwaInstallPromptShown', 'true');
                    });
                }
            });
            
            dismissBtn.addEventListener('click', () => {
                installPrompt.style.display = 'none';
                localStorage.setItem('pwaInstallPromptShown', 'true');
            });
        }

        // Handle successful installation
        window.addEventListener('appinstalled', (evt) => {
            console.log('2048 Pro was installed successfully');
        });

        // Enable background sync for offline functionality
        if ('serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype) {
            // Register for sync when the game state changes
            window.addEventListener('beforeunload', () => {
                navigator.serviceWorker.ready.then(registration => {
                    return registration.sync.register('save-game-data');
                });
            });
        }
    </script>
</body>

</html>
